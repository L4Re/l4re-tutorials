inherit: [ninja, patch, python3]

depends:
  - tools:
      target-toolchain: host-compat-toolchain
    depends:
      - name: python::west
        use: [tools]
      - name: devel::cross-toolchain-aarch64-none-elf
        use: [tools, environment]

metaEnvironment:
  PKG_VERSION: "3.7.1"
  PKG_LICENSE: "Apache-2.0"

checkoutSCM:
  scm: url
  url: https://github.com/zephyrproject-rtos/zephyr/archive/refs/tags/v${PKG_VERSION}.tar.gz
  stripComponents: 1
  digestSHA1: "11d9aeaa822664735e8385b83407dbb44754973d"

checkoutDeterministic: True
checkoutScript: |
  patchApplySeries $<<zephyr/*.patch>>

buildTools: [cmake, dtc, python3, target-toolchain, west]
buildVars: [CROSS_COMPILE]
buildScript: |
  export ZEPHYR_TOOLCHAIN_VARIANT=cross-compile
  export CROSS_COMPILE="${BOB_TOOL_PATHS[target-toolchain]}/$CROSS_COMPILE"
  export ZEPHYR_BASE="$1"

  cmake -B"$PWD/build" -GNinja -DUSER_CACHE_DIR=$PWD/cache \
    -DBOARD=fvp_baser_aemv8r -S"$1/samples/synchronization"
  ninjaParallel -C build

packageScript: |
  cp "$1/build/zephyr/zephyr.elf" .
